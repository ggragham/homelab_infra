---
version: '3'

services:
  {{ NEXTCLOUD_DOCKER_SERVICE_NAME }}:
    image: nextcloud:{{ NEXTCLOUD_DOCKER_VERSION }}
    container_name: {{ NEXTCLOUD_CONTAINER_NAME }}
    restart: always
    environment:
      MYSQL_HOST: {{ SERVER_IP }}:{{ MARIADB_PORT }}
      MYSQL_DATABASE: {{ NEXTCLOUD_DB_NAME }}
      MYSQL_USER: {{ NEXTCLOUD_DB_USER }}
      MYSQL_PASSWORD: {{ NEXTCLOUD_DB_PASSWORD }}
      OVERWRITEPROTOCOL: https
    networks:
      - nextcloud_network
      - nextcloud_nginx_network
    volumes:
      - {{ NEXTCLOUD_DATA_PATH }}:/var/www/html
      - {{ NEXTCLOUD_DOCKER_PATH }}/ports.conf:/etc/apache2/ports.conf
      - {{ NEXTCLOUD_DOCKER_PATH }}/000-default.conf:/etc/apache2/sites-enabled/000-default.conf

networks:
  nextcloud_network:
    ipam:
      config:
        - subnet: {{ NEXTCLOUD_DOCKER_SUBNET }}
  nextcloud_nginx_network:
    name: {{ NGINX_DOCKER_NETWORK_NAME }}
    external: true